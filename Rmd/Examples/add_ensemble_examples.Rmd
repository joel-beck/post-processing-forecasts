---
title: "Examples of `add_ensemble()` Function"
author: "Joel Beck"
output:
  bookdown::pdf_document2:
    highlight: tango
    toc: FALSE
    number_sections: FALSE
    df_print: tibble
    latex_engine: pdflatex
    keep_tex: FALSE
  bookdown::html_document2:
    theme: flatly
    highlight: pygments
    toc: TRUE
    toc_float: TRUE
    number_sections: FALSE
    df_print: tibble
urlcolor: blue
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, warning = FALSE, message = FALSE, fig.align = "center",
  out.width = "100%", dpi = 300, fig.asp = 0.618, collapse = TRUE
)
```

```{r}
devtools::load_all()
```

# UK Data

```{r}
df_combined <- readr::read_rds(here::here("data_results", "uk_cqr3.rds"))
df_subset <- df_combined |> dplyr::filter(model == unique(df_combined$model)[1])

df_ensemble <- add_ensemble(df_subset, verbose = TRUE)
```

# Interval Scores on Training Set

```{r}
# TODO: Ensemble should perform best on training set
df_ensemble |>
  extract_training_set() |>
  scoringutils::score() |>
  scoringutils::summarise_scores(by = "method") |>
  dplyr::select(method:overprediction)
```

# Interval Scores on Validation Set

```{r}
# TODO: Add option in add_ensemble() to evaluate on training or validation set
df_ensemble |>
  extract_validation_set() |>
  scoringutils::score() |>
  scoringutils::summarise_scores(by = c("method")) |>
  dplyr::select(method:overprediction)
```
