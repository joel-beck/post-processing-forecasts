<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Post-Processing COVID-19 Forecasts</title>
    <meta charset="utf-8" />
    <meta name="author" content="Matthias Herp &amp; Joel Beck" />
    <script src="second-presentation_files/header-attrs/header-attrs.js"></script>
    <link href="second-presentation_files/tile-view/tile-view.css" rel="stylesheet" />
    <script src="second-presentation_files/tile-view/tile-view.js"></script>
    <link href="second-presentation_files/panelset/panelset.css" rel="stylesheet" />
    <script src="second-presentation_files/panelset/panelset.js"></script>
    <script src="second-presentation_files/mark.js/mark.min.js"></script>
    <link href="second-presentation_files/xaringanExtra-search/search.css" rel="stylesheet" />
    <script src="second-presentation_files/xaringanExtra-search/search.js"></script>
    <script>window.addEventListener('load', function() { window.xeSearch = new RemarkSearch({"position":"bottom-left","caseSensitive":false,"showIcon":false,"autoSearch":false}) })</script>
    <link href="second-presentation_files/tachyons/tachyons.min.css" rel="stylesheet" />
    <script src="second-presentation_files/xaringanExtra_fit-screen/fit-screen.js"></script>
    <link href="second-presentation_files/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <script src="second-presentation_files/xaringanExtra-progressBar/progress-bar.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Post-Processing COVID-19 Forecasts
## - Second Presentation -<br><br>
### Matthias Herp &amp; Joel Beck
### 10.12.2021

---

&lt;!-- here classes for second slide --&gt;


&lt;!-- General Layout &amp; Workflow --&gt;
&lt;!-- ----------------------------------------------------------------------- --&gt;

&lt;!-- 
build pdf slides with the xaringanBuilder package 
use e.g. xaringanBuilder::build_pdf(input = "file-path", partial_slides = TRUE, complex_slides = FALSE, keep_intermediates = TRUE) 
--&gt;

&lt;!-- 
Slide Classes:

- top, middle, bottom
- left, center, right
- inverse

- background-image: url(link)
- background-size: cover | contain
- background-position: center

- name
- template
- layout: true | false
- count: false
- seal: true | false (create title slide from YAML header)


Content Classes:

- .left[], .center[], .right[] (alignment)
- .left-column[], .right-column[] (positioning, unequal width)
- .pull-left[], .pull-right[] (positioning, equal width)
- .footnote[]
- .color[]
- custom classes defined in CSS code chunks, 
e.g. .tiny[], .small[], .medium[], .large[], .huge[]


Colors:
- Color Scheme Generator: https://coolors.co/
- Google Color Picker

Images:
- Background Images: https://unsplash.com/

Fonts:
- Google Fonts: https://fonts.google.com/

Emojis:
- Find Emoji Name: https://emojipedia.org/
- Use Ermoji Addin to get Unicode Symbol or R Code for emo package
- emo Package: https://github.com/hadley/emo 

Icons:
- icon Package: https://pkg.mitchelloharawild.com/icons/

Embedding:
- Images and Gifs: usual Markdown Syntax ![]() or html syntax &lt;iframe&gt;&lt;/iframe&gt;
- Youtube Videos: Click 'Teilen =&gt; Einbetten' below the video, can also control the starting time of the video
- Example: &lt;iframe width="800" height="400" src="link" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen&gt;&lt;/iframe&gt;

--&gt;


&lt;!-- Settings for xaringanthemer &amp; xaringanExtra --&gt;
&lt;!-- ----------------------------------------------------------------------- --&gt;




&lt;!-- CSS Classes taken from Garrick Aiden-Buie's Blog --&gt;
&lt;!-- ----------------------------------------------------------------------- --&gt;

&lt;style type="text/css"&gt;
/* 
This code highlights the last item in an incremental list 
Add 'class: highlight-last-item' or 'class: bold-last-item' to slide 
*/

.highlight-last-item &gt; ul &gt; li, 
.highlight-last-item &gt; ol &gt; li {
  opacity: 0.5;
}

.highlight-last-item &gt; ul &gt; li:last-of-type,
.highlight-last-item &gt; ol &gt; li:last-of-type {
  opacity: 1;
}

.bold-last-item &gt; ul &gt; li:last-of-type,
.bold-last-item &gt; ol &gt; li:last-of-type {
  font-weight: bold;
}

/* fixes positioning of double .pull-left[] on same slide */
.pull-right ~ * { clear: unset; }
.pull-right + * { clear: both; }
&lt;/style&gt;

&lt;!-- 
CSS Changes in CSS code chunks **and** inside of &lt;style&gt; tags apply to the **entire** document, indpendent of their location.
To apply changes only to the current slide, create new CSS class and put text into enclosing brackets.

Thus, &lt;style&gt; tags are NOT necessary for xaringan !!
--&gt;


&lt;!-- CSS Classes taken from Thomas Mock --&gt;
&lt;!-- https://github.com/jthomasmock/tidymodels-workshops/blob/master/tidymodels-intro-phil.Rmd --&gt;
&lt;!-- ----------------------------------------------------------------------- --&gt;

&lt;style type="text/css"&gt;
.hljs-github .hjls {
  background: black;
}

.remark-slide thead, .remark-slide tr:nth-child(2n) {
  background-color: white;
}
.remark-slide thead, .remark-slide tr:nth-child(2n) {
  background-color: white;
}

/* footer specifications */
div.my-footer {
    background-color: #1a1917;
    position: absolute;
    bottom: 0px;
    left: 0px;
    height: 20px;
    width: 100%;
}
div.my-footer span {
    font-size: 10pt;
    color: #F7F8FA;
    position: absolute;
    left: 15px;
    bottom: 2px;
}
&lt;/style&gt;


&lt;!-- Custom CSS Classes --&gt;
&lt;!-- ----------------------------------------------------------------------- --&gt;

&lt;style type="text/css"&gt;
.bold {
  font-weight: bold;
}

.underline {
  text-decoration: underline;  
}

.mono {
  font-family: 'Fira Mono', monospace;
}

/* make left and right column horizontally aligned */
.right-column {
  padding-top: 0;
}

/* 
The first two commands change the background of the input code block,
the repeated commands with the star change the background of the output code block

With special name .remark-code this is set as the new default, add custom prefix ( e.g. .grey-code-bg .remark-code) to leave the default unchanged
*/
.remark-code, .remark-code * {
    background-color: #f0f2f0;
}
&lt;/style&gt;

&lt;style type="text/css"&gt;
/* Font Size Categories for Text and Code */
.size-60 {
  font-size: 60%;
}
.size-60 pre .remark-code {
  font-size: 60%;
}
.size-60 .remark-code {
  font-size: 60%;
}

.size-70 {
  font-size: 70%;
}
.size-70 pre .remark-code {
  font-size: 70%;
}
.size-70 .remark-code {
  font-size: 70%;
}

.size-80 {
  font-size: 80%;
}
.size-80 pre .remark-code {
  font-size: 80%;
}
.size-80 .remark-code {
  font-size: 80%;
}

.size-90 {
  font-size: 90%;
}
.size-90 pre .remark-code {
  font-size: 90%;
}
.size-90 .remark-code {
  font-size: 90%;
}

.size-100 {
  font-size: 100%;
}
.size-100 pre .remark-code {
  font-size: 100%;
}
.size-100 .remark-code {
  font-size: 100%;
}

.size-110 {
  font-size: 110%;
}
.size-110 pre .remark-code {
  font-size: 110%;
}
.size-110 .remark-code {
  font-size: 110%;
}

.size-120 {
  font-size: 120%;
}
.size-120 pre .remark-code {
  font-size: 120%;
}
.size-120 .remark-code {
  font-size: 120%;
}

.size-130 {
  font-size: 130%;
}
.size-130 pre .remark-code {
  font-size: 130%;
}
.size-130 .remark-code {
  font-size: 130%;
}

.size-140 {
  font-size: 140%;
}
.size-140 pre .remark-code {
  font-size: 140%;
}
.size-140 .remark-code {
  font-size: 140%;
}

.size-150 {
  font-size: 150%;
}
.size-150 pre .remark-code {
  font-size: 150%;
}
.size-150 .remark-code {
  font-size: 150%;
}
&lt;/style&gt;


&lt;style type="text/css"&gt;
/* Two - Column Layouts of different widths */
.left-75 {
  width: 75%;
  float: left;
}
.right-20 {
  width: 20%;
  float: right;
}
.right-20 + * {
  clear: both;
}


.left-70 {
  width: 70%;
  float: left;
}
.right-25 {
  width: 25%;
  float: right;
}
.right-25 + * {
  clear: both;
}


.left-65 {
  width: 65%;
  float: left;
}
.right-30 {
  width: 30%;
  float: right;
}
.right-30 + * {
  clear: both;
}


.left-60 {
  width: 60%;
  float: left;
}
.right-35 {
  width: 35%;
  float: right;
}
.right-35 + * {
  clear: both;
}


.left-55 {
  width: 55%;
  float: left;
}
.right-40 {
  width: 40%;
  float: right;
}
.right-40 + * {
  clear: both;
}


.left-40 {
  width: 40%;
  float: left;
}
.right-55 {
  width: 55%;
  float: right;
}
.right-55 + * {
  clear: both;
}


.left-35 {
  width: 35%;
  float: left;
}
.right-60 {
  width: 60%;
  float: right;
}
.right-60 + * {
  clear: both;
}


.left-30 {
  width: 30%;
  float: left;
}
.right-65 {
  width: 65%;
  float: right;
}
.right-65 + * {
  clear: both;
}


.left-25 {
  width: 25%;
  float: left;
}
.right-65 {
  width: 65%;
  float: right;
}
.right-65 + * {
  clear: both;
}


.left-20 {
  width: 20%;
  float: left;
}
.right-75 {
  width: 75%;
  float: right;
}
.right-75 + * {
  clear: both;
}
&lt;/style&gt;


&lt;!-- Code Chunk Options --&gt;
&lt;!-- ----------------------------------------------------------------------- --&gt;




&lt;!-- Example First Slide for Link Footer --&gt;
&lt;!-- ----------------------------------------------------------------------- --&gt;

&lt;!-- layout: true --&gt;

&lt;!-- &lt;div class="my-footer"&gt;&lt;span&gt;text&lt;/span&gt;&lt;/div&gt; --&gt;

&lt;!-- this adds the link footer to all slides, depends on my-footer class in css--&gt;

&lt;!-- --- --&gt;



&lt;!-- here content of second slide --&gt;

## Setting

- Post-Processing Covid19 forecasts: Systematically adjust existing prediction intervals with the goal of better out-of-sample performance

--

- Original forecasts from two data sources: The **UK Covid-19 Crowd Forecasting Challenge**&lt;sup&gt;1&lt;/sup&gt; (includes forecasts of non-expert individuals) and the **European Forecast Hub**&lt;sup&gt;2&lt;/sup&gt; (forecasts from international research groups)

.footnote[ 
[1] https://www.crowdforecastr.org/2021/05/11/uk-challenge/ &lt;br&gt;
[2] https://covid19forecasthub.eu/index.html
]

--

- The Quality of prediction intervals is measured by the **Weighted Interval Score** based on a trade-off between interval coverage and precision  

---
class: inverse, center, middle

# Conformalized Quantile Regression (CQR)

---

&lt;img src="second-presentation_files/figure-html/unnamed-chunk-3-1.png" width="100%" /&gt;

---

## CQR for UK Data

.left-30[ 
- Hypotheses: For most models (particular by individual humans) CQR makes the prediction intervals **wider** increasing the coverage at the cost of precision

- Often leads to improvement of Weighted Interval Score
]

--

.right-65[

For this specific covariate combination:

<div id="udzdipffen" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#udzdipffen .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#udzdipffen .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#udzdipffen .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#udzdipffen .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#udzdipffen .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#udzdipffen .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#udzdipffen .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#udzdipffen .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#udzdipffen .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#udzdipffen .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#udzdipffen .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#udzdipffen .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#udzdipffen .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#udzdipffen .gt_from_md > :first-child {
  margin-top: 0;
}

#udzdipffen .gt_from_md > :last-child {
  margin-bottom: 0;
}

#udzdipffen .gt_row {
  padding-top: 15px;
  padding-bottom: 15px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#udzdipffen .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#udzdipffen .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#udzdipffen .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#udzdipffen .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#udzdipffen .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#udzdipffen .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#udzdipffen .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#udzdipffen .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#udzdipffen .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#udzdipffen .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#udzdipffen .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#udzdipffen .gt_left {
  text-align: left;
}

#udzdipffen .gt_center {
  text-align: center;
}

#udzdipffen .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#udzdipffen .gt_font_normal {
  font-weight: normal;
}

#udzdipffen .gt_font_bold {
  font-weight: bold;
}

#udzdipffen .gt_font_italic {
  font-style: italic;
}

#udzdipffen .gt_super {
  font-size: 65%;
}

#udzdipffen .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">method</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">model</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">target_type</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">horizon</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">quantile</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">interval_score</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">dispersion</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">cqr</td>
<td class="gt_row gt_left">seabbs</td>
<td class="gt_row gt_left">Cases</td>
<td class="gt_row gt_right">3</td>
<td class="gt_row gt_right">0.1</td>
<td class="gt_row gt_right">157.319</td>
<td class="gt_row gt_right">87.485</td></tr>
    <tr><td class="gt_row gt_left gt_striped">original</td>
<td class="gt_row gt_left gt_striped">seabbs</td>
<td class="gt_row gt_left gt_striped">Cases</td>
<td class="gt_row gt_right gt_striped">3</td>
<td class="gt_row gt_right gt_striped">0.1</td>
<td class="gt_row gt_right gt_striped">210.622</td>
<td class="gt_row gt_right gt_striped">38.138</td></tr>
  </tbody>
  
  
</table>
</div>

Aggregated over all **models**, **target types**, **horizons** and **quantiles**:

<div id="bbcfxxhhyy" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#bbcfxxhhyy .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#bbcfxxhhyy .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bbcfxxhhyy .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#bbcfxxhhyy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#bbcfxxhhyy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bbcfxxhhyy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bbcfxxhhyy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#bbcfxxhhyy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#bbcfxxhhyy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#bbcfxxhhyy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#bbcfxxhhyy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#bbcfxxhhyy .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#bbcfxxhhyy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#bbcfxxhhyy .gt_from_md > :first-child {
  margin-top: 0;
}

#bbcfxxhhyy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#bbcfxxhhyy .gt_row {
  padding-top: 15px;
  padding-bottom: 15px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#bbcfxxhhyy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#bbcfxxhhyy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bbcfxxhhyy .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#bbcfxxhhyy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bbcfxxhhyy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#bbcfxxhhyy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#bbcfxxhhyy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bbcfxxhhyy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bbcfxxhhyy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#bbcfxxhhyy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bbcfxxhhyy .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#bbcfxxhhyy .gt_left {
  text-align: left;
}

#bbcfxxhhyy .gt_center {
  text-align: center;
}

#bbcfxxhhyy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#bbcfxxhhyy .gt_font_normal {
  font-weight: normal;
}

#bbcfxxhhyy .gt_font_bold {
  font-weight: bold;
}

#bbcfxxhhyy .gt_font_italic {
  font-style: italic;
}

#bbcfxxhhyy .gt_super {
  font-size: 65%;
}

#bbcfxxhhyy .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">method</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">interval_score</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">dispersion</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">cqr</td>
<td class="gt_row gt_right">62.186</td>
<td class="gt_row gt_right">24.129</td></tr>
    <tr><td class="gt_row gt_left gt_striped">original</td>
<td class="gt_row gt_right gt_striped">65.739</td>
<td class="gt_row gt_right gt_striped">12.001</td></tr>
  </tbody>
  
  
</table>
</div>

]

---

## Evaluation

- Apart from the absolute Interval Score change the **relative** or **percentage** change after applying CQR might be of interest

--

- New evaluation functions: **eval_methods()** and **plot_eval()**   

--

- Negative values indicate a score improvement, positive values a larger/worse interval score

--

- All displayed values are computed exclusively from the **validation** (out-of-sample) data 

---

## Which model benefits most?

.pull-left[ 


```r
eval_methods(uk_cqr, summarise_by = "model") |&gt;
  display_table()
```

<div id="junkucanni" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#junkucanni .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#junkucanni .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#junkucanni .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#junkucanni .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#junkucanni .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#junkucanni .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#junkucanni .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#junkucanni .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#junkucanni .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#junkucanni .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#junkucanni .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#junkucanni .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#junkucanni .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#junkucanni .gt_from_md > :first-child {
  margin-top: 0;
}

#junkucanni .gt_from_md > :last-child {
  margin-bottom: 0;
}

#junkucanni .gt_row {
  padding-top: 15px;
  padding-bottom: 15px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#junkucanni .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#junkucanni .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#junkucanni .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#junkucanni .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#junkucanni .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#junkucanni .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#junkucanni .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#junkucanni .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#junkucanni .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#junkucanni .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#junkucanni .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#junkucanni .gt_left {
  text-align: left;
}

#junkucanni .gt_center {
  text-align: center;
}

#junkucanni .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#junkucanni .gt_font_normal {
  font-weight: normal;
}

#junkucanni .gt_font_bold {
  font-weight: bold;
}

#junkucanni .gt_font_italic {
  font-style: italic;
}

#junkucanni .gt_super {
  font-size: 65%;
}

#junkucanni .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">model</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">relative_change</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">epiforecasts-EpiExpert</td>
<td class="gt_row gt_right">-0.057</td></tr>
    <tr><td class="gt_row gt_left gt_striped">epiforecasts-EpiExpert_direct</td>
<td class="gt_row gt_right gt_striped">-0.055</td></tr>
    <tr><td class="gt_row gt_left">epiforecasts-EpiExpert_Rt</td>
<td class="gt_row gt_right">-0.061</td></tr>
    <tr><td class="gt_row gt_left gt_striped">EuroCOVIDhub-baseline</td>
<td class="gt_row gt_right gt_striped">0.009</td></tr>
    <tr><td class="gt_row gt_left">EuroCOVIDhub-ensemble</td>
<td class="gt_row gt_right">-0.020</td></tr>
    <tr><td class="gt_row gt_left gt_striped">seabbs</td>
<td class="gt_row gt_right gt_striped">-0.085</td></tr>
  </tbody>
  
  
</table>
</div>

]

--

.pull-right[ 

- For many categories the magnitudes of the relative change is difficult to compare in the table output

- Visualize table either as barplot or heatmap

- Focus on models that participated regularly in the UK Forecasting Challenge

]

---

&lt;img src="second-presentation_files/figure-html/uk-cqr-plots1-1.png" width="100%" /&gt;

---

&lt;img src="second-presentation_files/figure-html/uk-cqr-plots2-1.png" width="100%" /&gt;

---

## CQR for European Forecast Hub Data

- We selected `\(18\)` European countries to conduct the analysis

--

- Several interesting questions to investigate:

--

- Do CQR improvements vary across countries?

--

- Do the findings from the much smaller UK Data Set generalize?

--

- For Germany CQR tends to extend original forecast intervals for **Cases** as before but decrease their width for **Deaths**  

---

&lt;img src="second-presentation_files/figure-html/unnamed-chunk-7-1.png" width="100%" /&gt;

---

## What's wrong with Poland?

.left-65[ 

&lt;img src="second-presentation_files/figure-html/hub-cqr-all-1.png" width="100%" /&gt;

]

.right-30[ 

- Visualization is dominated by the very large negative impact of CQR on Poland

- Have to exclude Poland to gain further insight about the remaining countries

- First, let's figure out why Poland is such an outlier

]

---

.pull-left[ 

## Training Set

<div id="wdwdyzwauv" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#wdwdyzwauv .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wdwdyzwauv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wdwdyzwauv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wdwdyzwauv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wdwdyzwauv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wdwdyzwauv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wdwdyzwauv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wdwdyzwauv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wdwdyzwauv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wdwdyzwauv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wdwdyzwauv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wdwdyzwauv .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#wdwdyzwauv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wdwdyzwauv .gt_from_md > :first-child {
  margin-top: 0;
}

#wdwdyzwauv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wdwdyzwauv .gt_row {
  padding-top: 15px;
  padding-bottom: 15px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wdwdyzwauv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#wdwdyzwauv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wdwdyzwauv .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#wdwdyzwauv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wdwdyzwauv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wdwdyzwauv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wdwdyzwauv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wdwdyzwauv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wdwdyzwauv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#wdwdyzwauv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wdwdyzwauv .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#wdwdyzwauv .gt_left {
  text-align: left;
}

#wdwdyzwauv .gt_center {
  text-align: center;
}

#wdwdyzwauv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wdwdyzwauv .gt_font_normal {
  font-weight: normal;
}

#wdwdyzwauv .gt_font_bold {
  font-weight: bold;
}

#wdwdyzwauv .gt_font_italic {
  font-style: italic;
}

#wdwdyzwauv .gt_super {
  font-size: 65%;
}

#wdwdyzwauv .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">method</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">model</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">interval_score</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">dispersion</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">cqr</td>
<td class="gt_row gt_left">epiforecasts-EpiNow2</td>
<td class="gt_row gt_right">22.844</td>
<td class="gt_row gt_right">7.241</td></tr>
    <tr><td class="gt_row gt_left gt_striped">original</td>
<td class="gt_row gt_left gt_striped">epiforecasts-EpiNow2</td>
<td class="gt_row gt_right gt_striped">23.712</td>
<td class="gt_row gt_right gt_striped">6.238</td></tr>
    <tr><td class="gt_row gt_left">cqr</td>
<td class="gt_row gt_left">EuroCOVIDhub-baseline</td>
<td class="gt_row gt_right">31.728</td>
<td class="gt_row gt_right">9.884</td></tr>
    <tr><td class="gt_row gt_left gt_striped">original</td>
<td class="gt_row gt_left gt_striped">EuroCOVIDhub-baseline</td>
<td class="gt_row gt_right gt_striped">35.782</td>
<td class="gt_row gt_right gt_striped">4.013</td></tr>
    <tr><td class="gt_row gt_left">cqr</td>
<td class="gt_row gt_left">EuroCOVIDhub-ensemble</td>
<td class="gt_row gt_right">29.444</td>
<td class="gt_row gt_right">9.754</td></tr>
    <tr><td class="gt_row gt_left gt_striped">original</td>
<td class="gt_row gt_left gt_striped">EuroCOVIDhub-ensemble</td>
<td class="gt_row gt_right gt_striped">31.367</td>
<td class="gt_row gt_right gt_striped">7.541</td></tr>
  </tbody>
  
  
</table>
</div>

]

--

.pull-right[ 

## Validation Set

<div id="rlkmyxgqhm" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#rlkmyxgqhm .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rlkmyxgqhm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rlkmyxgqhm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rlkmyxgqhm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rlkmyxgqhm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rlkmyxgqhm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rlkmyxgqhm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rlkmyxgqhm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rlkmyxgqhm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rlkmyxgqhm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rlkmyxgqhm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rlkmyxgqhm .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#rlkmyxgqhm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rlkmyxgqhm .gt_from_md > :first-child {
  margin-top: 0;
}

#rlkmyxgqhm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rlkmyxgqhm .gt_row {
  padding-top: 15px;
  padding-bottom: 15px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rlkmyxgqhm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#rlkmyxgqhm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rlkmyxgqhm .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#rlkmyxgqhm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rlkmyxgqhm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rlkmyxgqhm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rlkmyxgqhm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rlkmyxgqhm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rlkmyxgqhm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#rlkmyxgqhm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rlkmyxgqhm .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#rlkmyxgqhm .gt_left {
  text-align: left;
}

#rlkmyxgqhm .gt_center {
  text-align: center;
}

#rlkmyxgqhm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rlkmyxgqhm .gt_font_normal {
  font-weight: normal;
}

#rlkmyxgqhm .gt_font_bold {
  font-weight: bold;
}

#rlkmyxgqhm .gt_font_italic {
  font-style: italic;
}

#rlkmyxgqhm .gt_super {
  font-size: 65%;
}

#rlkmyxgqhm .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">method</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">model</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">interval_score</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">dispersion</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">cqr</td>
<td class="gt_row gt_left">epiforecasts-EpiNow2</td>
<td class="gt_row gt_right">1.942</td>
<td class="gt_row gt_right">1.213</td></tr>
    <tr><td class="gt_row gt_left gt_striped">original</td>
<td class="gt_row gt_left gt_striped">epiforecasts-EpiNow2</td>
<td class="gt_row gt_right gt_striped">1.322</td>
<td class="gt_row gt_right gt_striped">0.418</td></tr>
    <tr><td class="gt_row gt_left">cqr</td>
<td class="gt_row gt_left">EuroCOVIDhub-baseline</td>
<td class="gt_row gt_right">6.458</td>
<td class="gt_row gt_right">5.727</td></tr>
    <tr><td class="gt_row gt_left gt_striped">original</td>
<td class="gt_row gt_left gt_striped">EuroCOVIDhub-baseline</td>
<td class="gt_row gt_right gt_striped">3.344</td>
<td class="gt_row gt_right gt_striped">2.685</td></tr>
    <tr><td class="gt_row gt_left">cqr</td>
<td class="gt_row gt_left">EuroCOVIDhub-ensemble</td>
<td class="gt_row gt_right">2.339</td>
<td class="gt_row gt_right">1.868</td></tr>
    <tr><td class="gt_row gt_left gt_striped">original</td>
<td class="gt_row gt_left gt_striped">EuroCOVIDhub-ensemble</td>
<td class="gt_row gt_right gt_striped">0.964</td>
<td class="gt_row gt_right gt_striped">0.355</td></tr>
  </tbody>
  
  
</table>
</div>

]

--

&lt;br&gt;

Hypothesis: **Distribution Shift** between training period and validation period!

---

&lt;img src="second-presentation_files/figure-html/hub-cqr-poland-3-1.png" width="100%" /&gt;

---

## Findings for EU Hub

- As a final step, we exclude Poland and analyze CQR improvements for each combination of country with either **model**, **horizon**, **target type** and **quantile**   

--

- Largest relative performance boost for **USC-SIkJalpha** model from a research group of the University of California

--

- Recall that in the UK Data Set CQR improved interval scores most for **large forecast horizons**, **quantiles in the tails** of the predictive distribution and **Cases** instead of Deaths

--

- Same trends exist for the European Hub Data, although to a much more moderate degree

---

&lt;img src="second-presentation_files/figure-html/hub-cqr-no-poland-1-1.png" width="100%" /&gt;

---

&lt;img src="second-presentation_files/figure-html/hub-cqr-no-poland-2-1.png" width="100%" /&gt;

---
class: inverse, center, middle

# Quantile Spread Averaging (QSA)

---

## QSA - Intuition

- Define quantile spreads as the distance of a quantile from the median 

- Alternative are distance between neighboring quantiles or between symmetric quantiles

- Median basis makes spreads independent of the number of quantiles and allows for non-symmetry in adjustments

- Risks of quantile cutting 

---

## QSA - Theory 

Let `\(n\)` specify the number of observations in the training set within this combination, `\(\mathbf{y} \in \mathbb{R}^n\)` the vector of true values and `\(\hat{\mathbf{q}}_1, \ldots, \hat{\mathbf{q}}_p \in \mathbb{R}^n\)` vectors of quantile estimates for `\(p\)` different probability levels.

--

Then, for each time series, the quantile spread adjustment computes the quantile spread factors `\(\mathbf{f}^* \in R^p\)` by minimizing the weighted interval score:
$$
`\begin{aligned}
\mathbf{f}^*
= \operatorname*{arg\,min}_{ \mathbf{f} \in R^p} Score_\alpha(\mathbf{y})
&amp;= \sum_{i=1}^p \sum_{j=1}^n (u_{i,j}^*-l_{i,j}^*) + \frac{2}{\alpha} \cdot (l_{i,j}^*-y_j) \cdot \mathbf{1} (y_j \leq l_{i,j}^*) + \frac{2}{\alpha} \cdot (y_j-u_{i,j}^*) \cdot \mathbf{1}(y_j \geq u_{i,j}^*) \\
\text{s.t.} \qquad l_{i,j}^* = l_{i,j} + (l_{i,j}-m) * f_i \quad\text{and}\quad 
u_{i,j}^* = u_{i,j} + (m-u_{i,j}) * f_i 
\end{aligned}`
$$

---

## QSA - Implementation 

Postforecast offers three flavors of QSA where each restricts `\(\mathbf{f}^*\)` differently:
- uniform: `\(i \in [0,1,...,p-1,p] \quad f_i = c\)`
- flexibel: no restriction
- flexibel_symmetric: `\(i \in [0,1,...,m-1] \quad f_i = f_{p-i}\)`

Furthermore postforecast provides regularization towards QSA uniform by adding a regularization term `\(Pen(\mathbf{f})\)` with the weight `\(r\)` to the score function: 

$$
`\begin{aligned}
\mathbf{f}^*
= \operatorname*{arg\,min}_{\mathbf{f} \in R^p} \ Score_\alpha(\mathbf{y}) + r * Pen(\mathbf{f}) \quad Pen(\mathbf{f}) = \sum_{i=1}^p (f_i - \bar{f})^2 \\
\text{s.t.} \qquad \bar{f} = \frac{1}{p} \sum_{i=1}^p f_i
\end{aligned}`
$$
The optimization uses the function **optim** from the package **stats**&lt;sup&gt;1&lt;/sup&gt;. As optimization method we use the quasi-Newton method **BFGS**.

&lt;!-- read in preperation: https://en.wikipedia.org/wiki/Broyden–Fletcher–Goldfarb–Shanno_algorithm and find reference to the paper for footnotes. --&gt;

.footnote[ 
https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/optim
]

---

## QSA - Application



---
class: inverse, center, middle

# Ensemble Model

---

## Ensemble - Idea

- Find the best **convex combination** of post-processed predictions that minimizes the sum of squared residuals 

--

- Averages of independent prediction algorithms often lead to better performance than each individual predictor

---

## Ensemble - Exact Formulation

Consider one particular covariate combination of **model**, **location**, **horizon**, **target type** and **quantile**.

--

Let `\(n\)` specify the number of observations in the training set within this combination, `\(\mathbf{y} \in \mathbb{R}^n\)` the vector of true values and `\(\hat{\mathbf{y}}_1, \ldots, \hat{\mathbf{y}}_k \in \mathbb{R}^n\)` vectors of adjusted predictions from `\(k\)` different post-processing procedures.

--

Then, for each such combination, the ensemble model computes weights `\(\mathbf{w}^* \in [0, 1]^k\)` (technically `\(\mathbf{w}_{m, l, h, t, q}^*\)`) by solving the following constrained optimization problem:
$$
`\begin{aligned}
\mathbf{w}^*
= \operatorname*{arg\,min}_{ \mathbf{w} \in [0, 1]^k} \left \Vert \mathbf{y} - \sum_{j=1}^{k} w_j \hat{\mathbf{y}}_j \right \Vert_2^2
&amp;= \operatorname*{arg\,min}_{ \mathbf{w} \in [0, 1]^k} \sum_{i=1}^{n} \left(y_i - \sum_{j=1}^{k} w_j \hat{y}_{ij} \right)^2 \\
\text{s.t.} \qquad \sum_{j=1}^{k} w_j &amp;= 1
\end{aligned}`
$$
---

## Ensemble - Exact Formulation

Since we only consider the **CQR** and **QSA Uniform** methods in this case, the minimization objective above simplifies to
$$
`\begin{aligned}
\mathbf{w}^*
= \begin{pmatrix} w_1^* &amp; w_2^* \end{pmatrix}^T
= \operatorname*{arg\,min}_{w_1, w_2 \in [0, 1]} \sum_{i=1}^{n} \left(y_i - w_1 cqr_i - w_2 qsa_i \right)^2.
\end{aligned}`
$$
--

The optimization is implemented with the **quadprog**&lt;sup&gt;1&lt;/sup&gt; package which can also be used for more general quadratic programming problems.

.footnote[ 
https://cran.r-project.org/web/packages/quadprog/index.html
]

---

## Comparison of CQR, QSA and Ensemble

---
class: center, middle, inverse

# Outlook

---

## More Methods

- Stable package infrastructure that generalizes well to further Post-Processing methods 

--

- Candidate methods: **Quantile Regression Averaging** and **modified** versions of CQR 

--

- Comprehensive analysis of strength and weaknesses of each method 

---

## References

**Traditional CQR Method**

Romano Y., Patterson E., and Candès E. (2019). Conformalized Quantile Regression. *NeurIPS Annual Conference on Neural Information Processing Systems*.
  - Paper: https://proceedings.neurips.cc/paper/2019/file/5103c3584b063c431bd1268e9b5e76fb-Paper.pdf
  
  - Poster: https://github.com/yromano/cqr/blob/master/poster/CQR_Poster.pdf

&lt;br&gt;

**Variations and Extensions of CQR**

Tibshirani R. (2019). Advances and Challenges in Conformal Inference. *Carnegie Mellon University*.
  - Slides: .underline[www.stat.cmu.edu/~ryantibs/talks/conformal-2019.pdf]

---

## References

**More Information about the UK Covid-19 Forecasting Challenge**

- Website: https://www.crowdforecastr.org/2021/05/11/uk-challenge/

- Evaluation &amp; Ranking: https://epiforecasts.io/uk-challenge/

&lt;br&gt;

**More Information about the European Forecasting Hub**

- Website: https://covid19forecasthub.eu/index.html

- GitHub: https://github.com/epiforecasts/covid19-forecast-hub-europe
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current% / %total%",
"highlightStyle": "github",
"highlightLines": true,
"highlightSpans": true,
"ratio": "16:9",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
